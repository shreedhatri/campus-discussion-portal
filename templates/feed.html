{% extends "layout.html" %}
{% block body %}

<!-- ============================= -->
<!--       CREATE POST BOX         -->
<!-- ============================= -->
{% if g.user %}
<div class="composer">
  <div class="avatar"></div>
  <div style="flex:1">
    <form method="post" action="{{ url_for('add_post') }}">
      
      <!-- TITLE -->
      <div style="display:flex;gap:8px">
        <input class="input" name="title" placeholder="Post title (short)" required>
      </div>

      <!-- CONTENT -->
      <div style="margin-top:8px">
        <textarea class="input" name="content" placeholder="Share something with your campus..." rows="4"></textarea>
      </div>

      <!-- CHANNEL + TAGS -->
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
        
        <!-- Channel dropdown -->
        <select name="channel_id" style="padding:8px;border-radius:8px;border:1px solid #e6e9ef">
          {% for c in all_channels %}
            <option value="{{ c.channel_id }}">{{ c.channel_name }}</option>
          {% endfor %}
        </select>

        <!-- Tags input -->
        <input class="input" name="tags" placeholder="tags (comma separated)" style="width:220px">

        <button class="btn" type="submit">Post</button>
      </div>

      <div class="small" style="margin-top:8px">post_id auto-generates automatically.</div>
    </form>
  </div>
</div>
{% endif %}



<!-- ============================= -->
<!--        FEED POSTS LIST        -->
<!-- ============================= -->
{% for p in posts %}
<article class="card">

  <!-- -------- POST HEADER -------- -->
  <div class="card-head">
    <div class="avatar"></div>
    <div>
      <div>
        <span class="card-user">{{ p.user_name }}</span>
        <span class="card-meta">â€¢ {{ p.channel_name }}</span>
      </div>
      <div class="small">{{ p.Created_on }}</div>
    </div>
  </div>

  
  <!-- -------- POST BODY -------- -->
  <div class="card-body">
    <a href="{{ url_for('view_post', post_id=p.post_id) }}"
       style="font-weight:700;color:#0f172a;text-decoration:none">
      {{ p.title }}
    </a>
    <div style="margin-top:8px">{{ p.content }}</div>
  </div>


  <!-- -------- POST FOOTER -------- -->
  <div class="card-footer">

    <!-- LIKE BUTTON -->
    <form class="inline" method="post" action="{{ url_for('like_post', post_id=p.post_id) }}">
      <button class="btn-muted" type="submit">â™¡ Like</button>
    </form>

    <!-- COMMENT BUTTON -->
    <a class="btn-muted" style="margin-left:12px;"
       href="{{ url_for('view_post', post_id=p.post_id) }}">
       ðŸ’¬ {{ p.comment_count }} Comments
    </a>

    <!-- LIKE COUNT -->
    <span class="small" style="margin-left:auto;">
      {{ p.likes if p.likes else 0 }} Likes
    </span>

  </div>

</article>
{% else %}
  <div class="small">No posts yet</div>
{% endfor %}

{% endblock %}
