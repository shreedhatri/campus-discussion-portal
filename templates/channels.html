{% extends "layout.html" %}
{% block body %}
<h2>Channels</h2>
{% if g.user %}<p><a class="btn" href="{{ url_for('add_channel') }}">Create Channel</a></p>{% endif %}
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
  {% for c in channels %}
  <div style="background:#fff;padding:12px;border-radius:10px">
    <div style="font-weight:700">{{ c.channel_name }}</div>
    <div class="small">{{ c.description }}</div>
    <div style="margin-top:8px">
      <a class="btn btn-muted" href="{{ url_for('channel_messages', ch_id=c.channel_id) }}">Messages</a>
      {% if g.user %}
        {% if c.channel_id in joined %}
          <a class="btn" href="{{ url_for('leave_channel', ch_id=c.channel_id) }}" onclick="event.preventDefault(); document.getElementById('leave-{{c.channel_id}}').submit();">Leave</a>
          <form id="leave-{{c.channel_id}}" method="get" action="{{ url_for('leave_channel', ch_id=c.channel_id) }}" style="display:none"></form>
        {% else %}
          <a class="btn" href="{{ url_for('join_channel', ch_id=c.channel_id) }}" onclick="event.preventDefault(); document.getElementById('join-{{c.channel_id}}').submit();">Join</a>
          <form id="join-{{c.channel_id}}" method="get" action="{{ url_for('join_channel', ch_id=c.channel_id) }}" style="display:none"></form>
        {% endif %}
      {% endif %}
    </div>
  </div>
  {% else %}
    <div class="small">No channels</div>
  {% endfor %}
</div>
{% endblock %}
